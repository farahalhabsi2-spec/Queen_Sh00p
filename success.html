<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>كوين شوب 👑 | إتمام الطلب</title>
  <style>
    body {
      font-family: Tahoma, sans-serif;
      background: #fff0f8;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: #444;
    }
    .form-box, .success-box {
      background: #fff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      width: 90%;
      max-width: 400px;
      text-align: center;
      animation: fadeIn 0.7s ease;
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: scale(0.95);}
      to {opacity: 1; transform: scale(1);}
    }
    h2, h1 { color: #e60073; margin-bottom: 10px; }
    label { display: block; margin-top: 10px; color: #444; font-weight: bold; text-align: right; }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 15px;
    }
    button {
      width: 100%;
      padding: 12px;
      margin-top: 15px;
      border: none;
      border-radius: 6px;
      background: #e60073;
      color: #fff;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover { background: #c60060; }
    .hint { color: #777; font-size: 13px; margin-top: 4px; text-align: right; }
    .emoji { font-size: 50px; margin-bottom: 10px; }
    .details {
      background: #ffe4f2;
      border-radius: 10px;
      padding: 15px;
      margin-top: 10px;
      text-align: right;
      font-size: 15px;
      color: #333;
    }
    small {
      display: block;
      margin-top: 20px;
      font-size: 13px;
      opacity: 0.7;
    }
    .track-btn {
      background: #25d366;
      color: #fff;
      border: none;
      padding: 12px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      font-weight: bold;
      margin-top: 10px;
    }
    .track-btn:hover { background: #1ebe5d; }
  </style>
</head>
<body>

  <!-- ✅ نموذج الطلب -->
  <div class="form-box" id="checkoutPage">
    <h2>📝 إتمام الطلب</h2>
    <form id="checkoutForm">
      <label>👤 الاسم الكامل</label>
      <input type="text" id="customerName" required>

      <label>📍 العنوان الكامل</label>
      <textarea id="customerAddress" placeholder="الولاية - المنطقة - أقرب معلم" required></textarea>

      <label>📞 رقم الواتساب (بدون +)</label>
      <input type="tel" id="customerPhone" placeholder="مثال: 9689xxxxxxx" required>
      <div class="hint">أدخلي الرقم بهذا الشكل: 9689xxxxxxx</div>

      <label>💳 طريقة الدفع</label>
      <select id="payment">
        <option value="الدفع عند الاستلام">الدفع عند الاستلام</option>
        <option value="الدفع عبر الفيزا">الدفع عبر الفيزا</option>
      </select>

      <button type="button" onclick="confirmOrder()">✅ تأكيد الطلب</button>
    </form>
  </div>

  <!-- ✅ صفحة النجاح -->
  <div class="success-box" id="successPage" style="display:none;">
    <div class="emoji">💖</div>
    <h1>تم استلام طلبك بنجاح!</h1>
    <p>شكرًا لتسوقك من <strong>كوين شوب 👑</strong><br> سنقوم بالتواصل معك قريبًا لتأكيد الطلب ❤️</p>

    <div class="details">
      <p>🔢 رقم الطلب: <span id="orderId">...</span></p>
      <p>💵 الإجمالي: <span id="orderTotal">...</span> ر.ع</p>
      <p>👤 الزبونة: <span id="orderName">...</span></p>
    </div>

    <button onclick="goHome()">🏠 العودة إلى الصفحة الرئيسية</button>
    <button class="track-btn" onclick="trackOrder()">💬 تتبع طلبي عبر واتساب</button>

    <small>© 2025 كوين شوب · جميع الحقوق محفوظة 👑</small>
  </div>

  <script>
    function confirmOrder(){
      const name = document.getElementById("customerName").value.trim();
      const address = document.getElementById("customerAddress").value.trim();
      const phone = document.getElementById("customerPhone").value.trim();
      const payment = document.getElementById("payment").value;

      if(!name || !address || !phone){
        alert("يرجى تعبئة جميع الحقول قبل الإرسال.");
        return;
      }

      const items = JSON.parse(localStorage.getItem("cartItems")) || [];
      const total = localStorage.getItem("cartTotal") || "0.00";

      if(items.length === 0){
        alert("سلتك فارغة!");
        return;
      }

      const orderId = "Q" + Date.now().toString().slice(-6);
      const productList = items.map(it => `• ${it.name} - ${it.price} ر.ع`).join('\n');

      const message =
`🆔 رقم الطلب: ${orderId}
👑 طلب جديد من: ${name}
📍 العنوان: ${address}
💳 الدفع: ${payment}

📦 المنتجات:
${productList}

💵 الإجمالي: ${total} ر.ع
📱 رقم الزبونة: +${phone}`;

      const shopNumbers = ["96896036550", "96894623872"];
      shopNumbers.forEach((num, i)=>{
        setTimeout(()=>{
          window.open(`https://wa.me/${num}?text=${encodeURIComponent(message)}`,'_blank');
        }, i * 800);
      });

      // إرسال نسخة للزبونة
      setTimeout(()=>{
        const reply = `شكراً لطلبك من كوين شوب 👑\n\n${message}\n\nسنقوم بالتواصل معك قريباً ❤️`;
        window.open(`https://wa.me/${phone}?text=${encodeURIComponent(reply)}`,'_blank');
      }, 2000);

      // عرض صفحة النجاح
      document.getElementById("orderId").textContent = orderId;
      document.getElementById("orderTotal").textContent = total;
      document.getElementById("orderName").textContent = name;
      document.getElementById("checkoutPage").style.display = "none";
      document.getElementById("successPage").style.display = "block";

      // حفظ الطلب مؤقتاً لتتبع لاحق
      localStorage.setItem("lastOrderId", orderId);
      localStorage.setItem("lastOrderName", name);
      localStorage.setItem("lastOrderTotal", total);

      // تفريغ السلة
      localStorage.removeItem("cartItems");
      localStorage.removeItem("cartTotal");
    }

    function goHome(){
      window.location.href = "index.html";
    }

    function trackOrder(){
      const orderId = localStorage.getItem("lastOrderId") || "بدون رقم";
      const name = localStorage.getItem("lastOrderName") || "زبونة كوين شوب";
      const total = localStorage.getItem("lastOrderTotal") || "0.00";
      const msg = `📦 تتبع طلبي في كوين شوب 👑\n\n🆔 رقم الطلب: ${orderId}\n👤 الاسم: ${name}\n💵 الإجمالي: ${total} ر.ع\n\nأرغب بمعرفة حالة الطلب 🌸`;
      window.open(`https://wa.me/96896036550?text=${encodeURIComponent(msg)}`,'_blank');
    }
  </script>

</body>
</html>
